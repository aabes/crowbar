#!/usr/bin/perl

#
# Omnes relinquite spes, o vos intrantes ;-)
#

use strict;use warnings;my $ll11IlI1llII11IlIIIl1='';my $Il111111ll1IIII1l1lIl='1';my $I11ll11lI1ll1l1Il11l1="1.02";my $l11llII111lllI111IIl1="2011-06-07 17:03:27";my @l1lI11I111IIl1l11llII=( [qw(nic nic_selection 02 01 00 1 rw 0)], [qw(nic shared_nic_selection 02 02 00 1 rw 1)], );my @IlI1lI111I111I11l11lI=( [qw(sol sol_idle_timeout 03 01 00 2 rw 1)], );my @IlllllIIl1lIIIl1ll11I=( [qw(security service_disabled 04 01 00 1 rw 6)], );my @I1I1IllI1llIl11lII1ll=( [qw(acct_status num_of_users 05 01 00 1 r)], [qw(acct_status num_of_enabled_users 05 02 00 1 r)], [qw(acct_status user_name 05 03 00 17 r)], [qw(acct_status account_status 05 04 00 1 r)], );my @I11I1I1I1111ll1IlII11=( [qw(dns dns_dhcp_enable 06 01 00 1 rw 0)], [qw(dns dns_server_1 06 02 00 4 rw)], [qw(dns dns_server_2 06 03 00 4 rw)], [qw(dns dns_register_bmc 06 04 00 1 rw 0)], [qw(dns dns_bmc_hostname 06 05 00 64 rw)], [qw(dns dns_get_domain_from_dhcp 06 06 00 1 rw 0)], [qw(dns dns_domain_name 06 07 00 256 rw)], );my @II1I1lll1IIl1lll1Il1I=( [qw(websvr_cfg web_server_enabled 0c 01 00 1 rw 1)], [qw(websvr_cfg max_web_sessions 0c 02 00 1 r )], [qw(websvr_cfg active_web_sessions 0c 03 00 1 r )], [qw(websvr_cfg web_server_timeout 0c 04 00 4 rw 300)], [qw(websvr_cfg http_port 0c 05 00 2 rw 80)], [qw(websvr_cfg https_port 0c 06 00 2 rw 443)], );my @II1ll1lIlI1IIIl1l11II=( [qw(power_mgmt power_mgmt_enable 11 01 00 1 rw)], [qw(power_mgmt poweron_stagger_ac_recovery 11 02 00 1 rw)], [qw(power_mgmt poweron_delay 11 03 00 2 rw)], [qw(power_mgmt min_poweron_delay 11 04 00 2 r)], [qw(power_mgmt max_poweron_delay 11 05 00 2 rw)], );my @l11I1l11IllIl1lIIllIl=( [qw(ipv6 ipv6_enable c0 01 00 1 rw 0)], [qw(ipv6 ipv6_address c0 02 00 40 rw)], [qw(ipv6 ipv6_gateway_ip c0 03 00 40 rw)], [qw(ipv6 ipv6_prefix c0 04 00 1 rw)], [qw(ipv6 ipv6_autoconfig c0 05 00 1 rw 1)], [qw(ipv6 ipv6_link_local_addr c0 06 00 40 r)], [qw(ipv6 ipv6_auto_dns c0 07 00 1 rw 0)], [qw(ipv6 ipv6_dns_server_1 c0 08 00 40 rw)], [qw(ipv6 ipv6_dns_server_2 c0 09 00 40 rw)], );my @lIll1I1ll11l11Il1I1lI=( [qw(ipv6_trap ipv6_snmp_trap_dest c1 01 00 3 rw)], [qw(ipv6_trap ipv6_snmp_trap_dest_addr c1 02 00 40 rw)], [qw(ipv6_trap ipv6_num_of_trap_dest c1 03 00 1 r)], );my @ll1I11III1Il11l1lIll1=( @l1lI11I111IIl1l11llII, @IlI1lI111I111I11l11lI, @IlllllIIl1lIIIl1ll11I, @I1I1IllI1llIl11lII1ll, @I11I1I1I1111ll1IlII11, @II1I1lll1IIl1lll1Il1I, @II1ll1lIlI1IIIl1l11II, @l11I1l11IllIl1lIIllIl, @lIll1I1ll11l11Il1I1lI, );sub Il1I11IllllIll111Il1I{my $l1IIIIl1lI1lll1I1Il11=shift;my $i;my $II1II1I1I1lIl11I11llI=-1;for $i(0 .. $#ll1I11III1Il11l1lIll1){if($ll1I11III1Il11l1lIll1[$i][1] eq $l1IIIIl1lI1lll1I1Il11){$II1II1I1I1lIl11I11llI=$i;last;}}return $II1II1I1I1lIl11I11llI;}sub I111l1l11ll1IlI111ll1{my $x=shift;if(defined $x){$x=~s/^\s+//;$x=~s/\s+$//;}return $x;}sub l1l1III111ll1l1I11111{my $x=shift;if(defined $x){$x=~s/^\s+//;}return $x;}sub l111IIIlIII1I1I1lIIlI{my $x=shift;if(defined $x){$x=~s/\s+$//;}return $x;}sub lI1l111l1lI1l1111III1{my $IlIIIIl11III111l11IlI=shift;my $i;my @I11l111llI1ll1l1I11II;my $llII1l1ll11l1I1lI11lI;$IlIIIIl11III111l11IlI=I111l1l11ll1IlI111ll1($IlIIIIl11III111l11IlI);@I11l111llI1ll1l1I11II=split(/\./, $IlIIIIl11III111l11IlI);if($#I11l111llI1ll1l1I11II !=3){return 0;}for $i(0 .. $#I11l111llI1ll1l1I11II){if($I11l111llI1ll1l1I11II[$i]=~/^-?\d+$/){$llII1l1ll11l1I1lI11lI=int($I11l111llI1ll1l1I11II[$i]);if(($llII1l1ll11l1I1lI11lI < 0) ||($llII1l1ll11l1I1lI11lI >=256)){return 0;}}else{return 0;}}return 1;}sub lIlIIl1l1111lll11llIl{my $IlIIIIl11III111l11IlI=shift;$IlIIIIl11III111l11IlI=I111l1l11ll1IlI111ll1($IlIIIIl11III111l11IlI);my @I11l111llI1ll1l1I11II;my $i;my $llII1l1ll11l1I1lI11lI;my $lI11lll11IIII11II1lll="";@I11l111llI1ll1l1I11II=split(/\./, $IlIIIIl11III111l11IlI);for $i(0 .. $#I11l111llI1ll1l1I11II){$llII1l1ll11l1I1lI11lI=int($I11l111llI1ll1l1I11II[$i]);$lI11lll11IIII11II1lll .=sprintf("%02x", $llII1l1ll11l1I1lI11lI);if($i < $#I11l111llI1ll1l1I11II){$lI11lll11IIII11II1lll .=" ";}}return $lI11lll11IIII11II1lll;}sub l1lI1IIII1lIl11l1llIl{my $IlIIIIl11III111l11IlI=shift;$IlIIIIl11III111l11IlI=I111l1l11ll1IlI111ll1($IlIIIIl11III111l11IlI);my $llII1l1ll11l1I1lI11lI;my @I11l111llI1ll1l1I11II;my $i;my $lI11lll11IIII11II1lll="";@I11l111llI1ll1l1I11II=split(/\s+/,$IlIIIIl11III111l11IlI);for $i(0 .. $#I11l111llI1ll1l1I11II){$llII1l1ll11l1I1lI11lI=hex(I111l1l11ll1IlI111ll1($I11l111llI1ll1l1I11II[$i]));$lI11lll11IIII11II1lll .=sprintf("%d",$llII1l1ll11l1I1lI11lI);if($i < $#I11l111llI1ll1l1I11II){$lI11lll11IIII11II1lll .=".";}}return $lI11lll11IIII11II1lll;}sub IIlIll11l1lIIll111III{my $IlIIIIl11III111l11IlI=shift;my $l1II1111lII1I1l1Ill1l="";my @llI1l1llII111llIlll1l;my $i;@llI1l1llII111llIlll1l=split(/ +/, $IlIIIIl11III111l11IlI);for($i=0;$i<=$#llI1l1llII111llIlll1l;$i++){$l1II1111lII1I1l1Ill1l .="0x" . $llI1l1llII111llIlll1l[$i];if($i < $#llI1l1llII111llIlll1l){$l1II1111lII1I1l1Ill1l .=" ";}}return $l1II1111lII1I1l1Ill1l;}my $lII1llll1I1llI1II1ll1="";my $Ill11II1llllIlll1I1lI=$ll11IlI1llII11IlIIIl1;my $lll1I1lIl1l11IIIl1Ill="unknown";my $l1lIIlIll1II11I11lIlI=$ll11IlI1llII11IlIIIl1;sub II1I11l1Il1lI1IllllIl{my($l11llI11Il11lllIlIlI1, $II1IIIl1111l1I1I1I1ll)=@_;if($l11llI11Il11lllIlIlI1 eq "IPMITOOL"){$lII1llll1I1llI1II1ll1=$II1IIIl1111l1I1I1I1ll;}elsif($l11llI11Il11lllIlIlI1 eq "PLAT"){$lll1I1lIl1l11IIIl1Ill=$II1IIIl1111l1I1I1I1ll;}elsif($l11llI11Il11lllIlIlI1 eq "VERBOSE"){$Ill11II1llllIlll1I1lI=$II1IIIl1111l1I1I1I1ll;}elsif($l11llI11Il11lllIlIlI1 eq "IPMIDEBUG"){$l1lIIlIll1II11I11lIlI=$II1IIIl1111l1I1I1I1ll;}else{printf("Unknown variable requested to be set:  $l11llI11Il11lllIlIlI1\n");exit 1;}}sub IIl11llIl1lI111l1I1I1{my $I1IIII1I1IIlII1l1l111;my $III111IIIIII1lI1ll11l;my $l1lIIII1lI11II1IIl1l1="unknown";my $Il1Il1ll1lI11llIl1lII;$Il1Il1ll1lI11llIl1lII="$lII1llll1I1llI1II1ll1 fru | grep \"Product Name\" | cut -d\":\" -f2";$III111IIIIII1lI1ll11l=`$Il1Il1ll1lI11llIl1lII`;$III111IIIIII1lI1ll11l=uc($III111IIIIII1lI1ll11l);if(index($III111IIIIII1lI1ll11l, "C1100") >=0){$l1lIIII1lI11II1IIl1l1="C1100"}elsif(index($III111IIIIII1lI1ll11l, "C2100") >=0){$l1lIIII1lI11II1IIl1l1="C2100"}elsif(index($III111IIIIII1lI1ll11l, "C6100") >=0){$l1lIIII1lI11II1IIl1l1="C6100"}elsif(index($III111IIIIII1lI1ll11l, "C6105") >=0){$l1lIIII1lI11II1IIl1l1="C6105"}elsif(index($III111IIIIII1lI1ll11l, "C6145") >=0){$l1lIIII1lI11II1IIl1l1="C6145"}elsif(index($III111IIIIII1lI1ll11l, "5125") >=0){$l1lIIII1lI11II1IIl1l1="C5125"}$lll1I1lIl1l11IIIl1Ill=$l1lIIII1lI11II1IIl1l1;return $lll1I1lIl1l11IIIl1Ill;}sub IIlI11l1llIlIl1ll1llI{my($IlIIIIl11III111l11IlI)=@_;my @llI1l1llII111llIlll1l=split(/ +/, $IlIIIIl11III111l11IlI);my $i;my $II1II1I1I1lIl11I11llI="";for($i=$#llI1l1llII111llIlll1l;$i>=0;$i--){$II1II1I1I1lIl11I11llI .=$llI1l1llII111llIlll1l[$i];if($i > 0){$II1II1I1I1lIl11I11llI .=" ";}}return $II1II1I1I1lIl11I11llI;}sub II1lIlIl1I1IIllI1I11I{my($IlIIIIl11III111l11IlI)=@_;my @llI1l1llII111llIlll1l=split(/ +/, $IlIIIIl11III111l11IlI);my $i;my $I1ll11lI1ll1IIlIII1ll;my $I1IIII1I1IIlII1l1l111;my $llII1l1ll11l1I1lI11lI=0;$I1ll11lI1ll1IIlIII1ll=0;for($i=$#llI1l1llII111llIlll1l;$i>=0;$i--){$I1IIII1I1IIlII1l1l111=hex($llI1l1llII111llIlll1l[$i]);$I1IIII1I1IIlII1l1l111=$I1IIII1I1IIlII1l1l111 <<($I1ll11lI1ll1IIlIII1ll*8);$llII1l1ll11l1I1lI11lI +=$I1IIII1I1IIlII1l1l111;$I1ll11lI1ll1IIlIII1ll++;}return $llII1l1ll11l1I1lI11lI;}sub I111lll1Il1lII1l1l1I1{my($lllI1Il1I1l11l1I111Il, $I11llIII1I1IIlI111lIl)=@_;my $I1IIII1I1IIlII1l1l111;my $l1II1111lII1I1l1Ill1l="";my $i;my @llI1l1llII111llIlll1l;my $l1I1IllI1111I1ll111l1=$I11llIII1I1IIlI111lIl * 2;$I1IIII1I1IIlII1l1l111=sprintf("%0$l1I1IllI1111I1ll111l1" . "x", $lllI1Il1I1l11l1I111Il);for($i=0 ;$i<=length($I1IIII1I1IIlII1l1l111);$i++){$l1II1111lII1I1l1Ill1l .=substr($I1IIII1I1IIlII1l1l111, $i, 1);if((($i+1) % 2)==0){if(($i+1) < length($I1IIII1I1IIlII1l1l111)){$l1II1111lII1I1l1Ill1l .=" ";}}}return $l1II1111lII1I1l1Ill1l;}sub Il11IlIlI1IllllIIII11{my($IlIIIIl11III111l11IlI, $lI1ll1IlII1lI1IlII11I)=@_;my @llI1l1llII111llIlll1l=split(/ +/, $IlIIIIl11III111l11IlI);my $i;my $I1IIII1I1IIlII1l1l111;my $II1II1I1I1lIl11I11llI="";for($i=0 ;$i <=$#llI1l1llII111llIlll1l ;$i++){if(defined $lI1ll1IlII1lI1IlII11I){if($i < $lI1ll1IlII1lI1IlII11I){next;}}$I1IIII1I1IIlII1l1l111=hex($llI1l1llII111llIlll1l[$i]);$II1II1I1I1lIl11I11llI .=chr($I1IIII1I1IIlII1l1l111);}return $II1II1I1I1lIl11I11llI;}sub Il11II111l111lI11111I{my $II1II1I1I1lIl11I11llI="";my $Il1Il1l1IlII1l1111IIl="";my $i="";my $I1IIII1I1IIlII1l1l111;my $IlIIIIl11III111l11IlI=shift || "";my $I1l1Il1l11111IlI111lI=shift || $ll11IlI1llII11IlIIIl1;for($i=0 ;$i < length($IlIIIIl11III111l11IlI) ;$i++){$Il1Il1l1IlII1l1111IIl=substr($IlIIIIl11III111l11IlI, $i, 1);$II1II1I1I1lIl11I11llI .=sprintf(" 0x%02x",ord($Il1Il1l1IlII1l1111IIl));}if($I1l1Il1l11111IlI111lI){$I1IIII1I1IIlII1l1l111=sprintf " 0x%02x", length($IlIIIIl11III111l11IlI);$II1II1I1I1lIl11I11llI=$I1IIII1I1IIlII1l1l111 . $II1II1I1I1lIl11I11llI;}return $II1II1I1I1lIl11I11llI;}sub l1lIIlll1II1lI11IIII1{my($II111II1lIl11l1l11I1l)=@_;my $II1II1I1I1lIl11I11llI=`$lII1llll1I1llI1II1ll1 $II111II1lIl11l1l11I1l`;$II1II1I1I1lIl11I11llI=~s/(?>\n|\x0D\x0A)//g;$II1II1I1I1lIl11I11llI=I111l1l11ll1IlI111ll1($II1II1I1I1lIl11I11llI);if($l1lIIlIll1II11I11lIlI || $?){printf "ipmitool: sent:  $lII1llll1I1llI1II1ll1 $II111II1lIl11l1l11I1l\n";printf "ipmitool: rcvd:  $II1II1I1I1lIl11I11llI\n";}if($?){printf "ipmitool:  ERROR; exit code $?.  Halting.\n";exit $?;}return $II1II1I1I1lIl11I11llI;}sub Ill1lIIl1ll11Il1l1l1l{my($II111II1lIl11l1l11I1l)=@_;my $II1II1I1I1lIl11I11llI=`$lII1llll1I1llI1II1ll1 $II111II1lIl11l1l11I1l`;if($l1lIIlIll1II11I11lIlI || $?){printf "ipmitool: sent:  $lII1llll1I1llI1II1ll1 $II111II1lIl11l1l11I1l\n";printf "ipmitool: rcvd:  $II1II1I1I1lIl11I11llI\n";}if($?){printf "ipmitool:  ERROR; exit code $?.  Halting.\n";exit $?;}return $II1II1I1I1lIl11I11llI;}sub ll111llI111lIl1lll11I{my $II1II1I1I1lIl11I11llI;$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x30 0x01");if($? !=0){printf "Failed to acquire reservation: errno $?\n\n";exit 1;}return "0x" . I111l1l11ll1IlI111ll1($II1II1I1I1lIl11I11llI);}sub llllllIlIlI1IIIll111l{my $II1II1I1I1lIl11I11llI="";my $lIIlI1l1llI1111ll111l=join " ", @_;my @ll1lII1I1lI1Ill11IlII=split /\s+/, $lIIlI1l1llI1111ll111l;foreach(@ll1lII1I1lI1Ill11IlII){$_=I111l1l11ll1IlI111ll1($_);if($_ ne ""){if($_=~m/^0x/){$_=hex($_);}$II1II1I1I1lIl11I11llI .=sprintf("0x%02x ",$_);}}return I111l1l11ll1IlI111ll1($II1II1I1I1lIl11I11llI);}sub llI1lIl1lI1I11IIIIlI1{my $IIlII111I11lIllI1I1ll;my $lII1IlIl111IllllIIll1;my $i;my $I1IIII1I1IIlII1l1l111;my @llI1l1llII111llIlll1l;my $l1IlIIlll1lIlIIII11II;my $IlllllIlllIlIl1lI11l1=shift;my $I1lIlI1lIl1I11II1l1Il=shift;my $IlII1I1IIl1lll1IIlllI=shift;my $Ill111111I1lI1lllI1I1=shift;if(! defined $Ill111111I1lI1lllI1I1){$Ill111111I1lI1lllI1I1=1;}my $l1I1l11Ill1I1l1IIllIl=llllllIlIlI1IIIll111l($IlllllIlllIlIl1lI11l1);my $lll1lI1lll1lII1l1Il1I=llllllIlIlI1IIIll111l($I1lIlI1lIl1I11II1l1Il);my $Il1IlIlII1lI1l11l1Il1=llllllIlIlI1IIIll111l($IlII1I1IIl1lll1IIlllI);my $l1I1l111I111IlIII1IIl=llllllIlIlI1IIIll111l($Ill111111I1lI1lllI1I1);$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();if($Ill111111I1lI1lllI1I1 > 0){my @IIIllIIlIlIlI1Ill1llI;my @II1lllIIlIl1l1II1IIll;my $IlIIIl111IIllIl1l1lll="";$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("raw 0x30 0x02 $lII1IlIl111IllllIIll1 $l1I1l11Ill1I1l1IIllIl $lll1lI1lll1lII1l1Il1I $Il1IlIlII1lI1l11l1Il1 0x00 0x00 $l1I1l111I111IlIII1IIl");@IIIllIIlIlIlI1Ill1llI=split /\s+/, $I1IIII1I1IIlII1l1l111;@II1lllIIlIl1l1II1IIll=@IIIllIIlIlIlI1Ill1llI[4 .. $#IIIllIIlIlIlI1Ill1llI];$IlIIIl111IIllIl1l1lll .=join " ", @II1lllIIlIl1l1II1IIll;return $IlIIIl111IIllIl1l1lll;}else{$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("raw 0x30 0x02 $lII1IlIl111IllllIIll1 $l1I1l11Ill1I1l1IIllIl $lll1lI1lll1lII1l1Il1I $Il1IlIlII1lI1l11l1Il1 0x00 0x00 0x01");@llI1l1llII111llIlll1l=split(/ +/, $I1IIII1I1IIlII1l1l111);$IIlII111I11lIllI1I1ll=hex($llI1l1llII111llIlll1l[4]);$IIlII111I11lIllI1I1ll++;if($IIlII111I11lIllI1I1ll==1){return "";}$l1I1l111I111IlIII1IIl=sprintf "0x%02x", $IIlII111I11lIllI1I1ll;my $lllIIll1lll1lIl111lI1=$IIlII111I11lIllI1I1ll;my $l11IllIlI111I11IIlI11=$ll11IlI1llII11IlIIIl1;my $l1l11l1II1llIl1Il11l1=0x00;my $lIIIlII111IlIIIl11IlI;my $Il1l1ll1l1lI1Illl11lI;my $l11l1ll1IIIIIIlIl11lI;my $IlIIIl111IIllIl1l1lll="";my @IIIllIIlIlIlI1Ill1llI;my @II1lllIIlIl1l1II1IIll;my $llIII1I1l1lIl1l1llIl1=0x10;do{$Il1l1ll1l1lI1Illl11lI=llllllIlIlI1IIIll111l($lllIIll1lll1lIl111lI1);$lIIIlII111IlIIIl11IlI=llllllIlIlI1IIIll111l($l1l11l1II1llIl1Il11l1);if($lllIIll1lll1lIl111lI1 <=$llIII1I1l1lIl1l1llIl1){$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("raw 0x30 0x02 $lII1IlIl111IllllIIll1 $l1I1l11Ill1I1l1IIllIl $lll1lI1lll1lII1l1Il1I $Il1IlIlII1lI1l11l1Il1 $lIIIlII111IlIIIl11IlI 0x00 $Il1l1ll1l1lI1Illl11lI");@IIIllIIlIlIlI1Ill1llI=split /\s+/, $I1IIII1I1IIlII1l1l111;@II1lllIIlIl1l1II1IIll=@IIIllIIlIlIlI1Ill1llI[4 .. $#IIIllIIlIlIlI1Ill1llI];$IlIIIl111IIllIl1l1lll .=join " ", @II1lllIIlIl1l1II1IIll;$l11IllIlI111I11IIlI11=$Il111111ll1IIII1l1lIl;}else{$l11l1ll1IIIIIIlIl11lI="0x10";$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("raw 0x30 0x02 $lII1IlIl111IllllIIll1 $l1I1l11Ill1I1l1IIllIl $lll1lI1lll1lII1l1Il1I $Il1IlIlII1lI1l11l1Il1 $lIIIlII111IlIIIl11IlI 0x00 $l11l1ll1IIIIIIlIl11lI");@IIIllIIlIlIlI1Ill1llI=split /\s+/, $I1IIII1I1IIlII1l1l111;@II1lllIIlIl1l1II1IIll=@IIIllIIlIlIlI1Ill1llI[4 .. $#IIIllIIlIlIlI1Ill1llI];$IlIIIl111IIllIl1l1lll .=join " ", @II1lllIIlIl1l1II1IIll;$IlIIIl111IIllIl1l1lll .=" ";$l1l11l1II1llIl1Il11l1 +=$llIII1I1l1lIl1l1llIl1;$lllIIll1lll1lIl111lI1 -=$llIII1I1l1lIl1l1llIl1;}}while(! $l11IllIlI111I11IIlI11);$IlIIIl111IIllIl1l1lll=I111l1l11ll1IlI111ll1($IlIIIl111IIllIl1l1lll);$IlIIIl111IIllIl1l1lll=substr $IlIIIl111IIllIl1l1lll, 3;$IlIIIl111IIllIl1l1lll=I111l1l11ll1IlI111ll1($IlIIIl111IIllIl1l1lll);return $IlIIIl111IIllIl1l1lll;}}sub l11IllIllI1lIlIlIIlIl{my $lII1IlIl111IllllIIll1;my $I1IIII1I1IIlII1l1l111;my @l11lII111lllllllllIII;my $i;my $l1l11l1II1llIl1Il11l1;my $II1IIIl1111l1I1I1I1ll;my $IlllllIlllIlIl1lI11l1=shift;my $I1lIlI1lIl1I11II1l1Il=shift;my $IlII1I1IIl1lll1IIlllI=shift;my $I11llIII1I1IIlI111lIl=shift;my $l1I1l11Ill1I1l1IIllIl=llllllIlIlI1IIIll111l($IlllllIlllIlIl1lI11l1);my $lll1lI1lll1lII1l1Il1I=llllllIlIlI1IIIll111l($I1lIlI1lIl1I11II1l1Il);my $Il1IlIlII1lI1l11l1Il1=llllllIlIlI1IIIll111l($IlII1I1IIl1lll1IIlllI);my $IIllIll1I111II11Il1ll=llllllIlIlI1IIIll111l($I11llIII1I1IIlI111lIl);my $Ill11ll1lI1l1llllIlI1=shift;if($I11llIII1I1IIlI111lIl > 4){printf("set_ext_cfg_field_fixed has not been tested on field width > 4.  Halting.\n");exit(1);}@l11lII111lllllllllIII=split(/\s+/, $Ill11ll1lI1l1llllIlI1);if($I11llIII1I1IIlI111lIl !=($#l11lII111lllllllllIII + 1)){printf("set_ext_cfg_field_fixed:  Got the following data: $Ill11ll1lI1l1llllIlI1\n");printf("set_ext_cfg_field_fixed:  the passed in argument, field width (%d), does not match " . "the actual data's field width (%d)\n", $I11llIII1I1IIlI111lIl, $#l11lII111lllllllllIII + 1);printf("Halting.\n");exit 1;}$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();my $lI1l1I1Il1lI1l1l11ll1="0x01";$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("raw 0x30 0x03 $lII1IlIl111IllllIIll1 $l1I1l11Ill1I1l1IIllIl $lll1lI1lll1lII1l1Il1I $Il1IlIlII1lI1l11l1Il1 0x00 0x00 $lI1l1I1Il1lI1l1l11ll1 $Ill11ll1lI1l1llllIlI1");return 0;}sub ll1lllIlI111lIIl1I1lI{my $lII1IlIl111IllllIIll1;my $I1IIII1I1IIlII1l1l111;my $IlllllIlllIlIl1lI11l1=shift;my $I1lIlI1lIl1I11II1l1Il=shift;my $IlII1I1IIl1lll1IIlllI=shift;my $l1I1l11Ill1I1l1IIllIl=llllllIlIlI1IIIll111l($IlllllIlllIlIl1lI11l1);my $lll1lI1lll1lII1l1Il1I=llllllIlIlI1IIIll111l($I1lIlI1lIl1I11II1l1Il);my $Il1IlIlII1lI1l11l1Il1=llllllIlIlI1IIIll111l($IlII1I1IIl1lll1IIlllI);my $Il1ll11lIl1l1l1II1Ill="";foreach(@_){$Il1ll11lIl1l1l1II1Ill .=llllllIlIlI1IIIll111l($_) . " ";}my @Ill11ll1lI1l1llllIlI1=split /\s+/, $Il1ll11lIl1l1l1II1Ill;my $lllIIll1lll1lIl111lI1=@Ill11ll1lI1l1llllIlI1;$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();my $llIII1I1l1lIl1l1llIl1=0x10;my $l11IllIlI111I11IIlI11=$ll11IlI1llII11IlIIIl1;my $l1l11l1II1llIl1Il11l1=0x00;my $lIIIlII111IlIIIl11IlI;my $Il1l1ll1l1lI1Illl11lI;my $I1IIIII1I1llI11IlI1ll;my $III1lIIlIlI11l1I1IlI1;my @lIl1llI1lIIl11IIIIll1;my $lI1l1I1Il1lI1l1l11ll1="0x00";do{$Il1l1ll1l1lI1Illl11lI=llllllIlIlI1IIIll111l($lllIIll1lll1lIl111lI1);$lIIIlII111IlIIIl11IlI=llllllIlIlI1IIIll111l($l1l11l1II1llIl1Il11l1);if($lllIIll1lll1lIl111lI1 <=$llIII1I1l1lIl1l1llIl1){$lI1l1I1Il1lI1l1l11ll1="0x01";$III1lIIlIlI11l1I1IlI1=join " ", @Ill11ll1lI1l1llllIlI1;$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("raw 0x30 0x03 $lII1IlIl111IllllIIll1 $l1I1l11Ill1I1l1IIllIl $lll1lI1lll1lII1l1Il1I $Il1IlIlII1lI1l11l1Il1 $lIIIlII111IlIIIl11IlI 0x00 $lI1l1I1Il1lI1l1l11ll1 $III1lIIlIlI11l1I1IlI1");$l11IllIlI111I11IIlI11=$Il111111ll1IIII1l1lIl;}else{$I1IIIII1I1llI11IlI1ll="0x10";@lIl1llI1lIIl11IIIIll1=@Ill11ll1lI1l1llllIlI1[0..15];$III1lIIlIlI11l1I1IlI1=join " ", @lIl1llI1lIIl11IIIIll1;$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("raw 0x30 0x03 $lII1IlIl111IllllIIll1 $l1I1l11Ill1I1l1IIllIl $lll1lI1lll1lII1l1Il1I $Il1IlIlII1lI1l11l1Il1 $lIIIlII111IlIIIl11IlI 0x00 $lI1l1I1Il1lI1l1l11ll1 $III1lIIlIlI11l1I1IlI1");@Ill11ll1lI1l1llllIlI1=@Ill11ll1lI1l1llllIlI1[16 .. $#Ill11ll1lI1l1llllIlI1];$l1l11l1II1llIl1Il11l1 +=$llIII1I1l1lIl1l1llIl1;$lllIIll1lll1lIl111lI1 -=$llIII1I1l1lIl1l1llIl1;}}while(! $l11IllIlI111I11IIlI11);return 0;}use constant NOT_APPLICABLE=> 4;use constant UNIMPLEMENTED=> 5;use constant INVALID=> 6;my $Ill1ll1111I1lllI1IIl1;sub IlIlIlIlIlI11l1II1III{printf "Command is not applicable for platform $Ill1ll1111I1lllI1IIl1\n";exit NOT_APPLICABLE;}sub Il1lIlll11l1l1ll1I1Il{printf "Command is not implemented for platform $Ill1ll1111I1lllI1IIl1\n";exit UNIMPLEMENTED;}sub lIlI11IIIlll11I1IIII1{printf "Command syntax is invalid.\n";exit INVALID;}sub l1I11llI1Il1lIIlI1111{my $i;my $II1II1I1I1lIl11I11llI;my $I1IIII1I1IIlII1l1l111;my $lII1IlIl111IllllIIll1;my $I1Illlll11lIIl1lII11I=@_;my($ll11IIIll1l11lIllIllI, $II11I111ll1I1lIlIlll1, $lI11IIIIlII11IIIl1I1I, $I1IlI11llIII111Il1111, $ll11II11IlIl1IIll1lll)=@_;if($I1Illlll11lIIl1lII11I < 2){printf "Usage:\n";printf "     $ll11IIIll1l11lIllIllI  get|set  var1  var2  [opt_var1]\n";printf "\n";exit 1;};if($II11I111ll1I1lIlIlll1 eq "get"){exit 0;}Il1lIlll11l1l1ll1I1Il();}sub ll1Illl1I1l1lI1l11Il1{my $i;my $II1II1I1I1lIl11I11llI;my $I1IIII1I1IIlII1l1l111;my $lII1IlIl111IllllIIll1;my $I1Illlll11lIIl1lII11I=@_;my($ll11IIIll1l11lIllIllI, $II11I111ll1I1lIlIlll1, $lIlI1lIl11I11111llII1)=@_;if($I1Illlll11lIIl1lII11I < 2){printf "Usage:\n";printf "     $ll11IIIll1l11lIllIllI  get|set  [timeout_in_seconds; 0 to disable]\n";printf "\n";exit 1;};if($II11I111ll1I1lIlIlll1 eq "get"){$I1IIII1I1IIlII1l1l111=llI1lIl1lI1I11IIIIlI1(0x0C, 0x04, 0x00, 0x04);$I1IIII1I1IIlII1l1l111=IIlI11l1llIlIl1ll1llI($I1IIII1I1IIlII1l1l111);$I1IIII1I1IIlII1l1l111=II1lIlIl1I1IIllI1I11I($I1IIII1I1IIlII1l1l111);printf("%d\n",$I1IIII1I1IIlII1l1l111);exit 0;}if($II11I111ll1I1lIlIlll1 eq "set"){$I1IIII1I1IIlII1l1l111=I111lll1Il1lII1l1l1I1($lIlI1lIl11I11111llII1,4);$I1IIII1I1IIlII1l1l111=IIlI11l1llIlIl1ll1llI($I1IIII1I1IIlII1l1l111);$I1IIII1I1IIlII1l1l111=IIlIll11l1lIIll111III($I1IIII1I1IIlII1l1l111);l11IllIllI1lIlIlIIlIl(0x0C, 0x04, 0x00, 0x04, $I1IIII1I1IIlII1l1l111);exit 0;}Il1lIlll11l1l1ll1I1Il();}sub IIlIlll1ll1111I1l1Il1{my $i;my $II1II1I1I1lIl11I11llI;my $I1IIII1I1IIlII1l1l111;my $lII1IlIl111IllllIIll1;$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("mc reset cold");exit 0;}sub lI1llII1lIIllIIlI1111{my $II1II1I1I1lIl11I11llI;my $I1IIII1I1IIlII1l1l111;my $lII1IlIl111IllllIIll1;my $I1Illlll11lIIl1lII11I=@_;my($ll11IIIll1l11lIllIllI, $II11I111ll1I1lIlIlll1, $llllll1l1l1IIIlll111I)=@_;if($I1Illlll11lIIl1lII11I < 2){printf "Usage:\n";printf "     $ll11IIIll1l11lIllIllI  get|set  [hostname]\n";printf "\n";exit 1;};if($II11I111ll1I1lIlIlll1 eq "get"){$I1IIII1I1IIlII1l1l111=llI1lIl1lI1I11IIIIlI1(0x06, 0x05, 0x00, 0x00);$I1IIII1I1IIlII1l1l111=Il11IlIlI1IllllIIII11($I1IIII1I1IIlII1l1l111);printf "$I1IIII1I1IIlII1l1l111\n";exit 0;}if($II11I111ll1I1lIlIlll1 eq "set"){$llllll1l1l1IIIlll111I=substr $llllll1l1l1IIIlll111I, 0, 63;my $lII1l1l1IIIl1ll11IIll=Il11II111l111lI11111I($llllll1l1l1IIIlll111I, $Il111111ll1IIII1l1lIl);llI1lIl1lI1I11IIIIlI1(0x06, 0x04, 0x00, 0x01);ll1lllIlI111lIIl1I1lI(0x06, 0x04, 0x00, 0x00);sleep 1;llI1lIl1lI1I11IIIIlI1(0x06, 0x04, 0x00, 0x01);ll1lllIlI111lIIl1I1lI(0x06, 0x05, 0x00, $lII1l1l1IIIl1ll11IIll);sleep 1;exit 0;}Il1lIlll11l1l1ll1I1Il();}sub Ill1llIlII11I1l1IIllI{my $II1II1I1I1lIl11I11llI;my $I1IIII1I1IIlII1l1l111;my $l111IIII11Il1lll1Il11;my $i;my $lIl11lIIllIll1lII11Il;my $ll1l1I1111lIlllllll11;my $I1Illlll11lIIl1lII11I=@_;my $ll11IIIll1l11lIllIllI=shift;my $II11I111ll1I1lIlIlll1=shift;my $IlllllIlllIlIl1lI11l1=shift;my $I1lIlI1lIl1I11II1l1Il=shift;my $IlII1I1IIl1lll1IIlllI=shift;my $I11llIII1I1IIlI111lIl=shift;my $I1lI1lIl1I1Ill1I1lIlI=join " ", @_;my @lIl1IIlIllI11lII11111;my $I1llIlIIlIlll1IlllIlI;if($I1Illlll11lIIl1lII11I < 6){printf "Usage:\n";printf "     $ll11IIIll1l11lIllIllI  get|set cfg_id  att_id  tbl_id  field_width  [data_to_set]\n";printf "\n";printf "     Field width of zero implies that the field is variable-length (as compared to\n";printf "     a 1-4 byte fixed width field\n";printf "\n";exit 1;};$IlllllIlllIlIl1lI11l1=llllllIlIlI1IIIll111l($IlllllIlllIlIl1lI11l1);$I1lIlI1lIl1I11II1l1Il=llllllIlIlI1IIIll111l($I1lIlI1lIl1I11II1l1Il);$IlII1I1IIl1lll1IIlllI=llllllIlIlI1IIIll111l($IlII1I1IIl1lll1IIlllI);if($I11llIII1I1IIlI111lIl > 4){$I11llIII1I1IIlI111lIl=0;}if($II11I111ll1I1lIlIlll1 eq "get"){$I1IIII1I1IIlII1l1l111=llI1lIl1lI1I11IIIIlI1($IlllllIlllIlIl1lI11l1, $I1lIlI1lIl1I11II1l1Il, $IlII1I1IIl1lll1IIlllI, $I11llIII1I1IIlI111lIl);if($I11llIII1I1IIlI111lIl==0){printf("as hex:      %s\n",$I1IIII1I1IIlII1l1l111);$lIl11lIIllIll1lII11Il=Il11IlIlI1IllllIIII11($I1IIII1I1IIlII1l1l111);printf("as ASCII:    %s\n",$lIl11lIIllIll1lII11Il);}else{$I1IIII1I1IIlII1l1l111=IIlI11l1llIlIl1ll1llI($I1IIII1I1IIlII1l1l111);printf("as hex:      %s\n",$I1IIII1I1IIlII1l1l111);$ll1l1I1111lIlllllll11=II1lIlIl1I1IIllI1I11I($I1IIII1I1IIlII1l1l111);printf("as a number: %d\n",$ll1l1I1111lIlllllll11);}exit 0;}if($II11I111ll1I1lIlIlll1 eq "set"){if($I11llIII1I1IIlI111lIl==0){my $I1ll1111l1l1IIIllllIl=Il11II111l111lI11111I($I1lI1lIl1I1Ill1I1lIlI, $Il111111ll1IIII1l1lIl);ll1lllIlI111lIIl1I1lI($IlllllIlllIlIl1lI11l1, $I1lIlI1lIl1I11II1l1Il, $IlII1I1IIl1lll1IIlllI, $I1ll1111l1l1IIIllllIl);}else{$I1IIII1I1IIlII1l1l111=I111l1l11ll1IlI111ll1($I1lI1lIl1I1Ill1I1lIlI);@lIl1IIlIllI11lII11111=split(/\s+/,$I1IIII1I1IIlII1l1l111);$I1llIlIIlIlll1IlllIlI=$#lIl1IIlIllI11lII11111 + 1;if(($I11llIII1I1IIlI111lIl==4) &&($I1llIlIIlIlll1IlllIlI==4)){$I1IIII1I1IIlII1l1l111="";for $i(0 .. $#lIl1IIlIllI11lII11111){$I1IIII1I1IIlII1l1l111 .=I111lll1Il1lII1l1l1I1($lIl1IIlIllI11lII11111[$i], 1);if($i < $#lIl1IIlIllI11lII11111){$I1IIII1I1IIlII1l1l111 .=" ";}}}else{$I1IIII1I1IIlII1l1l111=I111lll1Il1lII1l1l1I1($I1lI1lIl1I1Ill1I1lIlI,$I11llIII1I1IIlI111lIl);}$I1IIII1I1IIlII1l1l111=IIlI11l1llIlIl1ll1llI($I1IIII1I1IIlII1l1l111);$I1IIII1I1IIlII1l1l111=IIlIll11l1lIIll111III($I1IIII1I1IIlII1l1l111);l11IllIllI1lIlIlIIlIl($IlllllIlllIlIl1lI11l1, $I1lIlI1lIl1I11II1l1Il, $IlII1I1IIl1lll1IIlllI, $I11llIII1I1IIlI111lIl, $I1IIII1I1IIlII1l1l111);}}}sub l1IIll1l11Il1I11II1Il{my $II1II1I1I1lIl11I11llI;my $I1IIII1I1IIlII1l1l111;my $lIl11lIIllIll1lII11Il;my $ll1l1I1111lIlllllll11;my $i;my $I1Illlll11lIIl1lII11I=@_;my $ll11IIIll1l11lIllIllI=shift;my $II11I111ll1I1lIlIlll1=shift;my $l1IIIIl1lI1lll1I1Il11=shift || "";my $I1l1III111I1III1IIIIl=join " ", @_;my $l1lIII11llII11IIIIIl1;my $lllIl1l111II1lII11111;my $IlllllIlllIlIl1lI11l1;my $I1lIlI1lIl1I11II1l1Il;my $IlII1I1IIl1lll1IIlllI;my $I11llIII1I1IIlI111lIl;my $Ill1l1I1IlI1II1II1l1l;my $IIII1l11lll1Il111II1l;if($I1Illlll11lIIl1lII11I < 2){printf "Usage:\n";printf "     $ll11IIIll1l11lIllIllI  list|get|set  [attr_name]  [attr_value]\n";printf "\n";printf "Note that not all attributes are supported on all platforms.\n";printf "\n";exit 1;};if($II11I111ll1I1lIlIlll1 eq "list"){printf "\n";printf "Available attributes:\n";printf "\n";printf "%17s  %6s  %s\n","Category", "Length", "Attribute";printf "%17s  %6s  %s\n","--------", "------", "---------";for($i=0;$i<=$#ll1I11III1Il11l1lIll1;$i++){printf("(%15s)  %6s  %s\n",$ll1I11III1Il11l1lIll1[$i][0],$ll1I11III1Il11l1lIll1[$i][5],$ll1I11III1Il11l1lIll1[$i][1]);}printf "\n";exit 0;}if(($II11I111ll1I1lIlIlll1 eq "get") ||($II11I111ll1I1lIlIlll1 eq "set")){$l1lIII11llII11IIIIIl1=Il1I11IllllIll111Il1I($l1IIIIl1lI1lll1I1Il11);if($l1lIII11llII11IIIIIl1 < 0){printf "Cannot find attribute $l1IIIIl1lI1lll1I1Il11.  Halting.\n";exit 1;}$lllIl1l111II1lII11111=$ll1I11III1Il11l1lIll1[$l1lIII11llII11IIIIIl1][0];$IlllllIlllIlIl1lI11l1=$ll1I11III1Il11l1lIll1[$l1lIII11llII11IIIIIl1][2];$I1lIlI1lIl1I11II1l1Il=$ll1I11III1Il11l1lIll1[$l1lIII11llII11IIIIIl1][3];$IlII1I1IIl1lll1IIlllI=$ll1I11III1Il11l1lIll1[$l1lIII11llII11IIIIIl1][4];$I11llIII1I1IIlI111lIl=$ll1I11III1Il11l1lIll1[$l1lIII11llII11IIIIIl1][5];$Ill1l1I1IlI1II1II1l1l=$ll1I11III1Il11l1lIll1[$l1lIII11llII11IIIIIl1][6];$IIII1l11lll1Il111II1l=$ll1I11III1Il11l1lIll1[$l1lIII11llII11IIIIIl1][7] || "";}if($II11I111ll1I1lIlIlll1 eq "get"){Ill1llIlII11I1l1IIllI("ext_cfg","get","0x" . $IlllllIlllIlIl1lI11l1, "0x" . $I1lIlI1lIl1I11II1l1Il, "0x" . $IlII1I1IIl1lll1IIlllI, $I11llIII1I1IIlI111lIl);exit 0;}if($II11I111ll1I1lIlIlll1 eq "set"){Ill1llIlII11I1l1IIllI("ext_cfg","set","0x" . $IlllllIlllIlIl1lI11l1, "0x" . $I1lIlI1lIl1I11II1l1Il, "0x" . $IlII1I1IIl1lll1IIlllI, $I11llIII1I1IIlI111lIl, $I1l1III111I1III1IIIIl);exit 0;}Il1lIlll11l1l1ll1I1Il();}sub IlIlIlI1l11IlIIlll1l1{my $II1II1I1I1lIl11I11llI;my $I1IIII1I1IIlII1l1l111;my $lII1IlIl111IllllIIll1;my $I1Illlll11lIIl1lII11I=@_;my $ll11IIIll1l11lIllIllI=shift;my $II11I111ll1I1lIlIlll1=shift;my $IlllllIlllIlIl1lI11l1=shift;my $I1lIlI1lIl1I11II1l1Il=shift;my $IlII1I1IIl1lll1IIlllI=shift;my $l1lIllIIllI1Illl1IIl1=shift || "0x00";my $I1Ill1IlIl11111Il1lll=shift || "0x00";my $IIlII111I11lIllI1I1ll=shift || "0x01";my $I1lI1lIl1I1Ill1I1lIlI=join " ", @_;if($I1Illlll11lIIl1lII11I < 5){printf "Usage:\n";printf "     $ll11IIIll1l11lIllIllI  get|set  cfg_id  att_id  tbl_id  [low_offset]  [hi_offset]  [length]  [data_to_set]\n";printf "\n";printf "If not specified, offsets default to 0, and length defaults to 1.\n";printf "\n";exit 1;};$IlllllIlllIlIl1lI11l1=llllllIlIlI1IIIll111l($IlllllIlllIlIl1lI11l1);$I1lIlI1lIl1I11II1l1Il=llllllIlIlI1IIIll111l($I1lIlI1lIl1I11II1l1Il);$IlII1I1IIl1lll1IIlllI=llllllIlIlI1IIIll111l($IlII1I1IIl1lll1IIlllI);printf "data to set: $I1lI1lIl1I1Ill1I1lIlI\n";if($II11I111ll1I1lIlIlll1 eq "get"){$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("raw 0x30 0x02 $lII1IlIl111IllllIIll1 $IlllllIlllIlIl1lI11l1 $I1lIlI1lIl1I11II1l1Il $IlII1I1IIl1lll1IIlllI $l1lIllIIllI1Illl1IIl1 $I1Ill1IlIl11111Il1lll $IIlII111I11lIllI1I1ll");printf "response was: $I1IIII1I1IIlII1l1l111\n\n";exit 0;}if($II11I111ll1I1lIlIlll1 eq "set"){$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("raw 0x30 0x03 $lII1IlIl111IllllIIll1 $IlllllIlllIlIl1lI11l1 $I1lIlI1lIl1I11II1l1Il $IlII1I1IIl1lll1IIlllI $l1lIllIIllI1Illl1IIl1 $I1Ill1IlIl11111Il1lll $IIlII111I11lIllI1I1ll $I1lI1lIl1I1Ill1I1lIlI");printf "response was: $I1IIII1I1IIlII1l1l111\n\n";exit 0;}Il1lIlll11l1l1ll1I1Il();}sub II1l1II11IlII1lIIllII{my $I1Illlll11lIIl1lII11I=@_;my($ll11IIIll1l11lIllIllI, $ll1Il1I1IIIl11IIllIIl)=@_;my $I1IIII1I1IIlII1l1l111;if($I1Illlll11lIIl1lII11I==1){printf "Usage:\n";printf "    $ll11IIIll1l11lIllIllI  on|off  \n";printf "\n";exit 1;}if($ll1Il1I1IIIl11IIllIIl eq "on"){$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("chassis identify force");exit 0;}if($ll1Il1I1IIIl11IIllIIl eq "off"){$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("chassis identify 0");exit 0;}lIlI11IIIlll11I1IIII1();}sub I1lI1IllIllIII11IlI11{my $I1Illlll11lIIl1lII11I=@_;my($ll11IIIll1l11lIllIllI, $lIl1ll1Il1lIl1Il11lIl)=@_;my $I1IIII1I1IIlII1l1l111;if($I1Illlll11lIIl1lII11I==1){printf "Usage:\n";printf "    $ll11IIIll1l11lIllIllI  status|on|off|cycle  \n";printf "\n";exit 1;}if(($lIl1ll1Il1lIl1Il11lIl eq "status") ||($lIl1ll1Il1lIl1Il11lIl eq "on") ||($lIl1ll1Il1lIl1Il11lIl eq "off") ||($lIl1ll1Il1lIl1Il11lIl eq "cycle")){$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("chassis power $lIl1ll1Il1lIl1Il11lIl");if($lIl1ll1Il1lIl1Il11lIl eq "status"){printf "$I1IIII1I1IIlII1l1l111\n";}exit 0;}lIlI11IIIlll11I1IIII1();}sub l1lIlIllll1l1lIIl1IlI{my $II1II1I1I1lIl11I11llI;my $I1IIII1I1IIlII1l1l111;my $I1Illlll11lIIl1lII11I=@_;my($ll11IIIll1l11lIllIllI, $II11I111ll1I1lIlIlll1, $IlIlllI1lIIl11II1I1lI, $l111II1IlII1I1I1lIII1, $l1I1l1I1IIII11IIl1II1)=@_;if($I1Illlll11lIIl1lII11I==1){printf "Usage:\n";printf "    $ll11IIIll1l11lIllIllI  get|set  user_number  name|callin|linkauth|ipmimsg|channelprivlimit  [val]\n";printf "\n";exit 1;};if($II11I111ll1I1lIlIlll1 eq "get"){$I1IIII1I1IIlII1l1l111=l1lIIlll1II1lI11IIII1("user list 1 | grep -ve '^ID' | grep -e '^$IlIlllI1lIIl11II1I1lI'");if(not defined $I1IIII1I1IIlII1l1l111){printf "\n";exit 0;}my @l1ll1l1l11Ill1II1l11l=split(/\s+/, $I1IIII1I1IIlII1l1l111);if(not defined $l111II1IlII1I1I1lIII1){$II1II1I1I1lIl11I11llI=sprintf "%s %s %s %s %s", $l1ll1l1l11Ill1II1l11l[1], $l1ll1l1l11Ill1II1l11l[2], $l1ll1l1l11Ill1II1l11l[3], $l1ll1l1l11Ill1II1l11l[4], $l1ll1l1l11Ill1II1l11l[5];}else{$_=$l111II1IlII1I1I1lIII1;if($_ eq "name"){$II1II1I1I1lIl11I11llI=$l1ll1l1l11Ill1II1l11l[1];}elsif($_ eq "callin"){$II1II1I1I1lIl11I11llI=$l1ll1l1l11Ill1II1l11l[2];}elsif($_ eq "linkauth"){$II1II1I1I1lIl11I11llI=$l1ll1l1l11Ill1II1l11l[3];}elsif($_ eq "ipmimsg"){$II1II1I1I1lIl11I11llI=$l1ll1l1l11Ill1II1l11l[4];}elsif($_ eq "channelprivlimit"){$II1II1I1I1lIl11I11llI=$l1ll1l1l11Ill1II1l11l[5];}else{printf "Unknown target field:  %s\n\n", $l111II1IlII1I1I1lIII1;exit 1;}}printf "%s\n", $II1II1I1I1lIl11I11llI;exit 0;}Il1lIlll11l1l1ll1I1Il();}sub Il1llIIlIl1IlIlIIlIll{my $II1II1I1I1lIl11I11llI;my $lII1IlIl111IllllIIll1;my $I1IIII1I1IIlII1l1l111;my $I1Illlll11lIIl1lII11I=@_;my($ll11IIIll1l11lIllIllI, $II11I111ll1I1lIlIlll1, $l1I1l1I1IIII11IIl1II1)=@_;if($I1Illlll11lIIl1lII11I==1){printf "Usage:\n";printf "    $ll11IIIll1l11lIllIllI  get|set  [on|off]\n";printf "\n";exit 1;}if($II11I111ll1I1lIlIlll1 eq "get"){$II1II1I1I1lIl11I11llI="unknown";$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x30 0x02 $lII1IlIl111IllllIIll1 0x04 0x01 0x00 0x00 0x00 0x01");print "$II1II1I1I1lIl11I11llI\n";$II1II1I1I1lIl11I11llI="unknown";$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x30 0x02 $lII1IlIl111IllllIIll1 0x03 0x02 0x00 0x00 0x00 0xFF");print "$II1II1I1I1lIl11I11llI\n";$II1II1I1I1lIl11I11llI="unknown";$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x30 0x02 $lII1IlIl111IllllIIll1 0x0C 0x01 0x00 0x00 0x00 0xFF");print "$II1II1I1I1lIl11I11llI\n";$II1II1I1I1lIl11I11llI="unknown";$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x30 0x02 $lII1IlIl111IllllIIll1 0x0C 0x05 0x00 0x00 0x00 0xFF");print "$II1II1I1I1lIl11I11llI\n";$II1II1I1I1lIl11I11llI="unknown";$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x30 0x02 $lII1IlIl111IllllIIll1 0x0C 0x06 0x00 0x00 0x00 0xFF");print "$II1II1I1I1lIl11I11llI\n";exit 0;}if($II11I111ll1I1lIlIlll1 eq "set"){if($l1I1l1I1IIII11IIl1II1 eq "on"){$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x30 0x03 $lII1IlIl111IllllIIll1 0x04 0x01 0x00 0x00 0x00 0x01 0x08");print "$II1II1I1I1lIl11I11llI\n";$II1II1I1I1lIl11I11llI="unknown";$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x30 0x03 $lII1IlIl111IllllIIll1 0x0C 0x01 0x00 0x00 0x00 0x01 0x01");print "$II1II1I1I1lIl11I11llI\n";$II1II1I1I1lIl11I11llI="unknown";$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x30 0x03 $lII1IlIl111IllllIIll1 0x0C 0x05 0x00 0x00 0x00 0x01 0x00 0x50");print "$II1II1I1I1lIl11I11llI\n";exit 0;}else {}}}sub ll11lIlIII11llll1lllI{my $II1II1I1I1lIl11I11llI;my $lII1IlIl111IllllIIll1;my $I1IIII1I1IIlII1l1l111;my $I1Illlll11lIIl1lII11I=@_;my($ll11IIIll1l11lIllIllI, $II11I111ll1I1lIlIlll1, $l1I1l1I1IIII11IIl1II1)=@_;if($I1Illlll11lIIl1lII11I < 2){printf "Usage:\n";printf "    $ll11IIIll1l11lIllIllI  get|set  [shared|dedicated]\n";printf "\n";exit 1;};$II1II1I1I1lIl11I11llI="unknown";if(($Ill1ll1111I1lllI1IIl1 eq "C1100") ||($Ill1ll1111I1lllI1IIl1 eq "C2100") ||($Ill1ll1111I1lllI1IIl1 eq "C6105") ||($Ill1ll1111I1lllI1IIl1 eq "C5125")){if($II11I111ll1I1lIlIlll1 eq "get"){$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x30 0x02 $lII1IlIl111IllllIIll1 0x02 0x01 0x00 0x00 0x00 1 | cut -d\" \" -f6");$I1IIII1I1IIlII1l1l111=$II1II1I1I1lIl11I11llI eq "00" ? "shared" :($II1II1I1I1lIl11I11llI eq "01" ? "dedicated" : "invalid: $II1II1I1I1lIl11I11llI");printf "$I1IIII1I1IIlII1l1l111\n";exit 0;}if($II11I111ll1I1lIlIlll1 eq "set"){$I1IIII1I1IIlII1l1l111=$l1I1l1I1IIII11IIl1II1 eq "shared" ? "00" : "01";$lII1IlIl111IllllIIll1=ll111llI111lIl1lll11I();$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x30 0x03 $lII1IlIl111IllllIIll1 0x02 0x01 0x00 0x00 0x00 1 $I1IIII1I1IIlII1l1l111");exit 0;}}if($Ill1ll1111I1lllI1IIl1 eq "C6100"){if($II11I111ll1I1lIlIlll1 eq "get"){$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x34 0x14 | cut -d\" \" -f2");$I1IIII1I1IIlII1l1l111=$II1II1I1I1lIl11I11llI eq "00" ? "shared" :($II1II1I1I1lIl11I11llI eq "01" ? "dedicated" : "invalid: $II1II1I1I1lIl11I11llI");printf "$I1IIII1I1IIlII1l1l111\n";exit 0;}if($II11I111ll1I1lIlIlll1 eq "set"){$I1IIII1I1IIlII1l1l111=$l1I1l1I1IIII11IIl1II1 eq "shared" ? "00" : "01";$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x34 0x13 $I1IIII1I1IIlII1l1l111");exit 0;}}Il1lIlll11l1l1ll1I1Il();}sub ll1lI1l1llllI1l1II11I{my $II1II1I1I1lIl11I11llI;$II1II1I1I1lIl11I11llI="unknown";if(($Ill1ll1111I1lllI1IIl1 eq "C1100") ||($Ill1ll1111I1lllI1IIl1 eq "C2100")){IlIlIlIlIlI11l1II1III();}if($Ill1ll1111I1lllI1IIl1 eq "C6100"){$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x34 0x11");printf "%d\n", $II1II1I1I1lIl11I11llI;exit 0;}if(($Ill1ll1111I1lllI1IIl1 eq "C6105") ||($Ill1ll1111I1lllI1IIl1 eq "C5125")){$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x30 0x2d");printf "%d\n", $II1II1I1I1lIl11I11llI;exit 0;}Il1lIlll11l1l1ll1I1Il();}sub llIIl1IIIIIl11l1lIl11{my $II1II1I1I1lIl11I11llI;my $l1lIl1I1IlI1111II11II="unknown";my @I11l111llI1ll1l1I11II;if($Ill1ll1111I1lllI1IIl1 eq "C6105"){$II1II1I1I1lIl11I11llI=l1lIIlll1II1lI11IIII1("raw 0x06 0x52 0x07 0xa0 0x06 0x3c 0x1d");$II1II1I1I1lIl11I11llI=I111l1l11ll1IlI111ll1($II1II1I1I1lIl11I11llI);@I11l111llI1ll1l1I11II=split(/\s+/, $II1II1I1I1lIl11I11llI);$II1II1I1I1lIl11I11llI=$I11l111llI1ll1l1I11II[0];if(hex($II1II1I1I1lIl11I11llI)==0x20){$l1lIl1I1IlI1111II11II="X3.5";}if(hex($II1II1I1I1lIl11I11llI)==0x30){$l1lIl1I1IlI1111II11II="Nucleon";}if(hex($II1II1I1I1lIl11I11llI)==0x40){$l1lIl1I1IlI1111II11II="Viper";}if(hex($II1II1I1I1lIl11I11llI)==0xff){$l1lIl1I1IlI1111II11II="unprogrammed";}printf("EEPROM returned:  $II1II1I1I1lIl11I11llI  ($l1lIl1I1IlI1111II11II)\n");exit 0;}IlIlIlIlIlI11l1II1III();}sub I1l11Illl1IllIIIII1ll{printf "%s\n", $Ill1ll1111I1lllI1IIl1;exit 0;}sub lII1l1II111IlIl1IIlI1{my $II1II1I1I1lIl11I11llI="unknown";my $I1IIII1I1IIlII1l1l111;my @I11l111llI1ll1l1I11II;my @I1lIll1IlllI1l1I11IlI;my $i;$I1IIII1I1IIlII1l1l111=Ill1lIIl1ll11Il1l1l1l("mc info");@I11l111llI1ll1l1I11II=split(/\n/,$I1IIII1I1IIlII1l1l111);for $i(0 .. $#I11l111llI1ll1l1I11II){if($I11l111llI1ll1l1I11II[$i]=~m/Firmware Revision/){@I1lIll1IlllI1l1I11IlI=split(/:/, $I11l111llI1ll1l1I11II[$i]);$II1II1I1I1lIl11I11llI=I111l1l11ll1IlI111ll1($I1lIll1IlllI1l1I11IlI[1]);last;}}printf "%s\n", $II1II1I1I1lIl11I11llI;exit 0;}my $I1ll1IIll111Il1IlIII1=$Il111111ll1IIII1l1lIl;my $I1Illlll11lIIl1lII11I;my $i;my $lIl1I11lllll1lIIl1lII;my $lII1ll1111llIl1I1Illl;my $IIIll1lII1IIIllIllIll="root";my $l1Il1IIlIIIll11II1l1l="root";$I1Illlll11lIIl1lII11I=$#ARGV + 1;if($I1Illlll11lIIl1lII11I==0){l1IlI1Ill1llIIl11I1II($0);exit 1;}my $I1lIlIllllIIIl1ll1I11;my $lI1lI11lllll11IlII1l1;my $I1IIII1I1IIlII1l1l111;for($i=0 ;$i <=$#ARGV ;$i++){$I1lIlIllllIIIl1ll1I11="";$lI1lI11lllll11IlII1l1="";$I1IIII1I1IIlII1l1l111=$ARGV[$i];if($I1IIII1I1IIlII1l1l111=~m/^-/){if(length($I1IIII1I1IIlII1l1l111) < 2){next;}if(length($I1IIII1I1IIlII1l1l111)==2){$I1lIlIllllIIIl1ll1I11=substr($I1IIII1I1IIlII1l1l111,1,1);if($i+1 <=$#ARGV){if(!($ARGV[$i+1]=~m/^-/)){$lI1lI11lllll11IlII1l1=$ARGV[$i+1];$i++;}}}else{$I1lIlIllllIIIl1ll1I11=substr($I1IIII1I1IIlII1l1l111,1,1);$lI1lI11lllll11IlII1l1=substr($I1IIII1I1IIlII1l1l111,2);}$_=$I1lIlIllllIIIl1ll1I11;if($_ eq "H"){$I1ll1IIll111Il1IlIII1=$ll11IlI1llII11IlIIIl1;$lII1ll1111llIl1I1Illl=$lI1lI11lllll11IlII1l1;}elsif($_ eq "U"){$I1ll1IIll111Il1IlIII1=$ll11IlI1llII11IlIIIl1;$IIIll1lII1IIIllIllIll=$lI1lI11lllll11IlII1l1;}elsif($_ eq "P"){$I1ll1IIll111Il1IlIII1=$ll11IlI1llII11IlIIIl1;$l1Il1IIlIIIll11II1l1l=$lI1lI11lllll11IlII1l1;}elsif($_ eq "v"){II1I11l1Il1lI1IllllIl("VERBOSE",$Il111111ll1IIII1l1lIl);}else{print "Unrecognized switch: -$_\n";l1IlI1Ill1llIIl11I1II($0);exit 1;}}else{last;}}my @Il11l111lIIlIllIlIl11=();@Il11l111lIIlIllIlIl11=@ARGV[$i .. $#ARGV];if(! @Il11l111lIIlIllIlIl11){l1IlI1Ill1llIIl11I1II($0);exit 1;}$lIl1I11lllll1lIIl1lII=$ENV{'IPMITOOL'}|| 'ipmitool';if(! $I1ll1IIll111Il1IlIII1){$lIl1I11lllll1lIIl1lII .=" -Ilanplus -H$lII1ll1111llIl1I1Illl -U$IIIll1lII1IIIllIllIll -P$l1Il1IIlIIIll11II1l1l";}II1I11l1Il1lI1IllllIl("IPMITOOL",$lIl1I11lllll1lIIl1lII);if(defined $ENV{'IPMIDEBUG'}){II1I11l1Il1lI1IllllIl("IPMIDEBUG", $Il111111ll1IIII1l1lIl);}$Ill1ll1111I1lllI1IIl1=IIl11llIl1lI111l1I1I1();$_=$Il11l111lIIlIllIlIl11[0];if($_ eq "nic_mode"){ll11lIlIII11llll1lllI(@Il11l111lIIlIllIlIl11);}elsif($_ eq "users"){l1lIlIllll1l1lIIl1IlI(@Il11l111lIIlIllIlIl11);}elsif($_ eq "ssh_telnet_redirect"){Il1llIIlIl1IlIlIIlIll(@Il11l111lIIlIllIlIl11);}elsif($_ eq "node_number"){ll1lI1l1llllI1l1II11I(@Il11l111lIIlIllIlIl11);}elsif($_ eq "ext_cfg"){Ill1llIlII11I1l1IIllI(@Il11l111lIIlIllIlIl11);}elsif($_ eq "ext_cfg_raw"){IlIlIlI1l11IlIIlll1l1(@Il11l111lIIlIllIlIl11);}elsif($_ eq "bmc_hostname"){lI1llII1lIIllIIlI1111(@Il11l111lIIlIllIlIl11);}elsif($_ eq "reset"){IIlIlll1ll1111I1l1Il1(@Il11l111lIIlIllIlIl11);}elsif($_ eq "platform"){I1l11Illl1IllIIIII1ll(@Il11l111lIIlIllIlIl11);}elsif($_ eq "version"){lII1l1II111IlIl1IIlI1(@Il11l111lIIlIllIlIl11);}elsif($_ eq "gui_timeout"){ll1Illl1I1l1lI1l11Il1(@Il11l111lIIlIllIlIl11);}elsif($_ eq "attr"){l1IIll1l11Il1I11II1Il(@Il11l111lIIlIllIlIl11);}elsif($_ eq "id_led"){II1l1II11IlII1lIIllII(@Il11l111lIIlIllIlIl11);}elsif($_ eq "power"){I1lI1IllIllIII11IlI11(@Il11l111lIIlIllIlIl11);}elsif($_ eq "c6105_chassis_type"){llIIl1IIIIIl11l1lIl11(@Il11l111lIIlIllIlIl11);}else{printf "Unknown command:  %s\n\n", $_;exit 1;}exit 0;sub l1IlI1Ill1llIIl11I1II{my $l1lIlIlI1ll11Il1III1l=shift;printf "\n";printf "Dell DCS/PE-C BMC manipulation tool | v$I11ll11lI1ll1l1Il11l1 | $l11llII111lllI111IIl1\n";printf "Usage: \n";printf "\n";printf '%s  [-v]  [IPMI Connection Info]  command_name  arguments\n', $0;printf "\n\n";printf "    General Options\n";printf "      -v verbose output\n";printf "\n";printf "    IPMI Connection Info (default is the local system KCS interface, so these aren't required)\n";printf "      -H hostname\n";printf "      -U user    \n";printf "      -P password\n";printf "\n";printf "    Supported commands:\n";printf "      version               Report the BMC firmware level\n";printf "      platform              Report the platform type of the target BMC\n";printf "      node_number           Report the node number (if this BMC is in shared infr. chassis)\n";printf "      reset                 Reboot the BMC\n";printf "      power                 Get/set chassis power\n";printf "      nic_mode              Get/set BMC ethernet mode (shared/dedicated)\n";printf "      users\n";printf "      bmc_hostname          Get/set BMC hostname\n";printf "      gui_timeout           Get/set time before BMC Web GUI session expires\n";printf "      id_led                Toggle the blue identification LED\n";printf "\n";printf "      attr                  (Long list of configurable attributes)\n";printf "\n";printf "    Highly specific per-platform\n";printf "      c6105_chassis_type    Show this sled's programmed target chassis type\n";printf "\n";printf "      ext_cfg               (developer debug only)\n";printf "      ext_cfg_raw           (developer debug only.  You don't want to use this.  Use ext_cfg.)\n";printf "\n";printf "      ssh_telnet_redirect\n";printf "\n";}